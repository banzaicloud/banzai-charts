apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app: {{ template "prometheus.name" . }}
    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
  name: {{ .Release.Name }}-cp-alertmanager
data:
  alertmanager.yml: |-
    global:
      slack_api_url: {{ .Values.prometheus.alertmanager.slack_api_url }}
      smtp_smarthost: {{ .Values.prometheus.alertmanager.smtp_address }}
      smtp_from: {{ .Values.prometheus.alertmanager.smtp_from }}
      smtp_auth_username: {{ .Values.prometheus.alertmanager.smtp_username }}
      smtp_auth_password: {{ .Values.prometheus.alertmanager.smtp_password }}
    receivers:
      - name: default-receiver
        slack_configs:
        - channel: {{ .Values.prometheus.alertmanager.slack_channel }}
          send_resolved: true
        email_configs:
        - to: {{ .Values.prometheus.alertmanager.smtp_to }}
    route:
      group_wait: 10s
      group_interval: 5m
      receiver: default-receiver
      repeat_interval: 3h
